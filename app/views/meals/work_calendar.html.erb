<% content_for(:title){ "Work Calendar" } %>

<form class="form-inline index-filter">
  <%= label_tag("uid", "Filter by User:") %>
  <%= select_tag("uid", options_from_collection_for_select(@users, :id, :name, params[:uid]),
    prompt: "Select User...", class: "form-control", onchange: "this.form.submit();") %>
  <% if params[:uid].present? %>
    <%= link_to("Clear", "#", onclick: "$('#uid').val(''); $('.index-filter').submit(); return false;") %>
  <% end %>
</form>

<table class="index non-mobile">
  <tr>
    <th class="col-md-2">Date/Time</th>
    <th class="col-md-1">Location</th>
    <th class="col-md-3">Title</th>
    <th class="col-md-2">Head Cook</th>
    <th class="col-md-2">Assistant Cooks</th>
    <th class="col-md-2">Cleaners</th>
    <th></th>
  </tr>
  <% @meals.each do |meal| %>
    <tr class="<%= signed_up_class(meal) %>">
      <td class="col-md-2"><%= meal_date_time(meal) %></td>
      <td class="col-md-1"><%= meal.location_abbrv %></td>
      <td class="col-md-3"><%= render("meal_link", meal: meal) %></td>
      <td class="col-md-2"><%= user_link(meal.head_cook, params[:uid]) %></td>
      <td class="col-md-2"><%= meal.asst_cooks.map{ |c| user_link(c, params[:uid]) }.reduce(:<<) %></td>
      <td class="col-md-2"><%= meal.cleaners.map{ |c| user_link(c, params[:uid]) }.reduce(:<<) %></td>
      <td></td>
    </tr>
  <% end %>
</table>

<div class="meals-list mobile">
  <% @meals.each do |meal| %>
    <div class="meal <%= signed_up_class(meal) %>">
      <h4><%= meal_date_time(meal) %></h4>
      <div class="title">
        <%= render("meal_link", meal: meal) %> at <%= meal.location_abbrv %>
      </div>
      <div class="jobs">
        <div class="job"><%= user_link(meal.head_cook, params[:uid]) %> (Head)</div>
        <% meal.asst_cooks.each do |u| %>
          <div class="job"><%= user_link(u, params[:uid]) %> (Asst)</div>
        <% end %>
        <% meal.cleaners.each do |u| %>
          <div class="job"><%= user_link(u, params[:uid]) %> (Clean)</div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>

<%= paginate @meals %>
