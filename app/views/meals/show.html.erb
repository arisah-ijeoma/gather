<% content_for(:title){ (@meal.title || "Untitled Meal") } %>

<div class="row">
  <div class="col-sm-8">
    <div class="meal-menu ">
      <div class="menu-label">menu</div>
      <div class="action-icons"><%= meal_action_icons(@meal) %></div>
      <h3><%= @meal.title %></h3>
      <div class="time-place">
        <%= icon_tag("calendar") %>
        <strong><%= meal_date_time(@meal) %></strong> at
        <%= @meal.location_name %>
      </div>
      <div class="head-cook-communities">
        By <%= user_link(@meal.head_cook) %> for
        <%= @meal.communities.map(&:name).join(', ') %>
      </div>
      <div class="asst-cooks">
        Assistants:
        <%= "[None]" if @meal.asst_cooks.empty? %>
        <% @meal.asst_cooks.each do |u| %>
          <div class="job"><%= user_link(u) %></div>
        <% end %>
      </div>
      <div class="cleaners">
        Cleaners:
        <%= "[None]" if @meal.cleaners.empty? %>
        <% @meal.cleaners.each do |u| %>
          <div class="job"><%= user_link(u) %></div>
        <% end %>
      </div>
      <% Meal::MENU_ITEMS.each do |item| %>
        <hr/>
        <div class="menu-label smaller"><%= item %></div>
        <section><%= simple_format(@meal.send(item)) %></section>
      <% end %>
      <hr/>
      <div class="menu-label smaller">allergens</div>
      <section>
        <%= @meal.allergens.map{ |a| t("activerecord.attributes.meal.allergen_#{a}") }.join(", ") %>
      </section>
    </div>
  </div>

  <div class="signup col-sm-4">
    <div class="row">
      <div class="prev-meal col-sm-6">
        <% if @prev_meal.present? %>
          <small>Previous Meal</small>
          <%= meal_link(@prev_meal) %>
          <small><%= meal_date_time(@prev_meal) %></small>
        <% end %>
      </div>
      <div class="next-meal col-sm-6">
        <% if @next_meal.present? %>
          <small>Next Meal</small>
          <%= meal_link(@next_meal) %>
          <small><%= meal_date_time(@next_meal) %></small>
        <% end %>
      </div>
    </div>

    <%= link_to(icon_tag('close'), "#", title: "Clear Form",
      onclick: "$('.signup select').val(0); $('.signup textarea').val(''); return false") %>

    <h4>Signups for <%= current_user.household_full_name %></h4>
    <%= simple_form_for(@signup, wrapper: :equal_width_form, html: { class: 'form-horizontal' }) do |f| %>
      <%= hidden_field_tag("next_meal_id", @next_meal.try(:id)) %>
      <%= f.input :meal_id, as: :hidden %>
      <% Signup::SIGNUP_TYPES.each do |type| %>
        <%= f.input type, collection: 0..Signup::MAX_PEOPLE_PER_TYPE, include_blank: false %>
      <% end %>
      <%= f.input :comments %>
      <div class="pull-right">
        <%= f.button :submit, "Save", class: @next_meal ? "" : "btn-primary" %>
        <%= f.button :submit, "Save & Go To Next", name: "save_and_next", class: "btn-primary" if @next_meal %>
      </div>
    <% end %>
  </div>
</div>
