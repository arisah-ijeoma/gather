<%# Renders a set of nested fields handled by cocoon. Assumes all model stuff is in place. %>
<% partial_path = "#{f.object.class.model_name.route_key}/#{assoc.to_s.singularize}_fields" %>
<%= f.input assoc, options.slice(:required) do %>
  <div class="nested-field-set">
    <%= f.simple_fields_for assoc, wrapper: :nested_fields do |f2| %>
      <%= render(partial_path, f: f2, options: options) %>
    <% end %>
    <span><%= link_to_add_association t("cocoon.add_links.#{assoc}"), f, assoc, partial: partial_path,
      render_options: {wrapper: :nested_fields, locals: {options: options}} %></span>
  </div>
<% end %>
